# Sistema de GestiÃ³n de Citas MÃ©dicas ğŸ¥

Sistema de gestiÃ³n de citas mÃ©dicas implementado con **Arquitectura Orientada a Servicios (SOA)** utilizando el patrÃ³n de **OrquestaciÃ³n** para coordinar mÃºltiples servicios independientes.

[![.NET Framework](https://img.shields.io/badge/.NET%20Framework-4.6.2-blue)](https://dotnet.microsoft.com/)
[![License](https://img.shields.io/badge/license-MIT-green)](LICENSE)
[![Status](https://img.shields.io/badge/status-active-success)]()

---

## ğŸ“‹ Tabla de Contenidos

- [DescripciÃ³n](#descripciÃ³n)
- [Arquitectura](#arquitectura)
- [CaracterÃ­sticas](#caracterÃ­sticas)
- [TecnologÃ­as](#tecnologÃ­as)
- [Requisitos Previos](#requisitos-previos)
- [InstalaciÃ³n](#instalaciÃ³n)
- [ConfiguraciÃ³n](#configuraciÃ³n)
- [Uso](#uso)
- [API Endpoints](#api-endpoints)
- [Casos de Prueba](#casos-de-prueba)
- [Estructura del Proyecto](#estructura-del-proyecto)
- [DocumentaciÃ³n](#documentaciÃ³n)
- [ContribuciÃ³n](#contribuciÃ³n)
- [Licencia](#licencia)
- [Autor](#autor)

---

## ğŸ“– DescripciÃ³n

Este proyecto implementa un sistema completo de gestiÃ³n de citas mÃ©dicas que permite a pacientes agendar citas con mÃ©dicos, procesar pagos, enviar notificaciones y gestionar la disponibilidad de horarios. Utiliza el patrÃ³n de **OrquestaciÃ³n SOA** donde un coordinador central (`AppointmentCoordinator`) gestiona el flujo completo de creaciÃ³n de citas, invocando mÃºltiples servicios independientes.

### Objetivo AcadÃ©mico

Este proyecto fue desarrollado como parte de un trabajo acadÃ©mico sobre arquitecturas de software, especÃ­ficamente para demostrar la implementaciÃ³n prÃ¡ctica del patrÃ³n SOA con orquestaciÃ³n en un contexto de salud digital.

---

## ğŸ—ï¸ Arquitectura

### Diagrama de Arquitectura LÃ³gica

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Clientes (Web, MÃ³vil)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Gateway (Punto de Entrada)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AppointmentCoordinator (Orquestador)            â”‚
â”‚      - Coordina el flujo de creaciÃ³n de citas        â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
   â–¼    â–¼    â–¼    â–¼    â–¼    â–¼
â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”
â”‚Pat â”‚â”‚Doc â”‚â”‚Sch â”‚â”‚Pay â”‚â”‚Not â”‚
â”‚Svc â”‚â”‚Svc â”‚â”‚Svc â”‚â”‚Svc â”‚â”‚Svc â”‚
â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜
   â”‚    â”‚    â”‚    â”‚    â”‚
   â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   SQL Server    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Message Bus   â”‚
                    â”‚   (RabbitMQ)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Componentes Principales

- **AppointmentCoordinator**: Orquestador central que coordina el proceso completo
- **PatientService**: GestiÃ³n de pacientes
- **DoctorService**: GestiÃ³n de mÃ©dicos y especialidades
- **ScheduleService**: Control de disponibilidad y agenda
- **PaymentService**: Procesamiento de pagos
- **NotificationService**: EnvÃ­o de notificaciones (email/SMS)
- **Message Bus**: Sistema de mensajerÃ­a asÃ­ncrona (RabbitMQ)

---

## âœ¨ CaracterÃ­sticas

- **PatrÃ³n SOA con OrquestaciÃ³n**: CoordinaciÃ³n centralizada de servicios
- **Servicios independientes**: Cada servicio tiene responsabilidad Ãºnica
- **ComunicaciÃ³n asÃ­ncrona**: Message bus para eventos desacoplados
- **Validaciones robustas**: VerificaciÃ³n de datos en mÃºltiples niveles
- **Manejo de errores**: Try-catch centralizado con logging exhaustivo
- **Transacciones atÃ³micas**: Rollback automÃ¡tico en caso de fallos
- **PrevenciÃ³n de doble reserva**: Control de concurrencia en horarios
- **Procesamiento de pagos**: IntegraciÃ³n con pasarelas de pago
- **Notificaciones automÃ¡ticas**: Confirmaciones por email
- **Logging detallado**: Trazabilidad completa de operaciones
- **InyecciÃ³n de dependencias**: Bajo acoplamiento con Autofac
- **API RESTful**: Endpoints estÃ¡ndar con documentaciÃ³n

---

## ğŸ› ï¸ TecnologÃ­as

### Backend
- **Framework**: ASP.NET Web API (.NET Framework 4.6.2)
- **Lenguaje**: C# 7.3
- **Base de Datos**: SQL Server 2022
- **ORM**: Dapper (micro-ORM de alto rendimiento)
- **DI Container**: Autofac 6.5.0
- **SerializaciÃ³n**: Newtonsoft.Json 13.0.3

### Infraestructura
- **Message Bus**: RabbitMQ 6.5.0
- **Servidor Web**: IIS 10
- **Testing**: NUnit / Postman

### Patrones de DiseÃ±o
- Service-Oriented Architecture (SOA)
- Orchestration Pattern
- Repository Pattern
- Dependency Injection
- Async/Await Pattern

---

## ğŸ“¦ Requisitos Previos

Antes de comenzar, asegÃºrate de tener instalado:

- [Visual Studio 2019/2022](https://visualstudio.microsoft.com/downloads/)
- [.NET Framework 4.6.2 SDK](https://dotnet.microsoft.com/download/dotnet-framework)
- [SQL Server 2019+](https://www.microsoft.com/sql-server/sql-server-downloads) o SQL Server Express
- [SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms)
- [Postman](https://www.postman.com/downloads/) (opcional, para pruebas)
- [RabbitMQ](https://www.rabbitmq.com/download.html) (opcional, se puede usar mock)

---

## ğŸš€ InstalaciÃ³n

### 1. Clonar el Repositorio

```bash
git clone https://github.com/tu-usuario/medical-appointments-api.git
cd medical-appointments-api
```

### 2. Restaurar Paquetes NuGet

Abrir el proyecto en Visual Studio y ejecutar:

```powershell
# En la Consola del Administrador de Paquetes
Update-Package -reinstall
```

O desde la lÃ­nea de comandos:

```bash
nuget restore WebApiCitas.sln
```

### 3. Crear la Base de Datos

Abrir **SQL Server Management Studio** y ejecutar el script:

```sql
-- Ver archivo: /Database/CreateDatabase.sql
```

O ejecutar desde lÃ­nea de comandos:

```bash
sqlcmd -S localhost -i Database/CreateDatabase.sql
```

### 4. Configurar Connection String

Editar el archivo `Web.config`:

```xml
<connectionStrings>
  <add name="MedicalAppointmentsDB" 
       connectionString="Server=TU_SERVIDOR;Database=MedicalAppointments;Integrated Security=true;" 
       providerName="System.Data.SqlClient" />
</connectionStrings>
```

### 5. Compilar y Ejecutar

```bash
# Compilar
msbuild WebApiCitas.sln /p:Configuration=Release

# O presionar F5 en Visual Studio
```

La aplicaciÃ³n estarÃ¡ disponible en: `http://localhost:44385`

---

## âš™ï¸ ConfiguraciÃ³n

### Variables de ConfiguraciÃ³n (Web.config)

```xml
<appSettings>
  <!-- Message Bus -->
  <add key="RabbitMQ:Host" value="localhost" />
  <add key="RabbitMQ:Port" value="5672" />
  
  <!-- Email (SMTP) -->
  <add key="SMTP:Host" value="smtp.gmail.com" />
  <add key="SMTP:Port" value="587" />
  <add key="SMTP:User" value="tu-email@gmail.com" />
  <add key="SMTP:Password" value="tu-app-password" />
</appSettings>
```

### ConfiguraciÃ³n de Servicios

El proyecto usa **Autofac** para inyecciÃ³n de dependencias. La configuraciÃ³n estÃ¡ en:

```
App_Start/DependencyConfig.cs
```

Para usar **MockMessageBus** en lugar de RabbitMQ (desarrollo):

```csharp
// En DependencyConfig.cs
builder.RegisterType<MockMessageBus>()
    .As<IMessageBus>()
    .SingleInstance();
```

---

## ğŸ’» Uso

### Crear una Cita MÃ©dica

**Endpoint:** `POST /api/appointmentCoordinator`

**Request:**
```json
{
  "patientId": 1,
  "doctorId": 2,
  "appointmentDate": "2025-11-01T10:30:00",
  "reason": "Consulta general",
  "payment": {
    "amount": 85000,
    "paymentMethod": "Credit Card"
  }
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "appointmentId": 15,
  "message": "Cita agendada exitosamente",
  "data": {
    "appointmentId": 15,
    "scheduledDate": "2025-11-01T10:30:00",
    "doctorName": "Dr. Roberto MartÃ­nez",
    "patientName": "Juan PÃ©rez",
    "notificationSent": true,
    "paymentProcessed": true
  }
}
```

### Cancelar una Cita

**Endpoint:** `PUT /api/appointments/cancel/{id}`

```bash
curl -X PUT http://localhost:44385/api/appointments/cancel/15
```

---

## ğŸ”Œ API Endpoints

### Orquestador de Citas

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| POST | `/api/appointmentCoordinator` | Crear nueva cita |

### Pacientes

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| GET | `/api/patients/{id}` | Obtener paciente por ID |
| POST | `/api/patients` | Registrar nuevo paciente |

### MÃ©dicos

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| GET | `/api/doctors/{id}` | Obtener mÃ©dico por ID |
| GET | `/api/doctors?specialty=X` | Listar mÃ©dicos por especialidad |

### Agenda

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| GET | `/api/appointments/availability?doctorId=X&date=Y` | Consultar disponibilidad |
| POST | `/api/appointments/schedule` | Reservar horario |

### CancelaciÃ³n

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| PUT | `/api/appointments/cancel/{id}` | Cancelar cita |

### Notificaciones

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| POST | `/api/notifications/send` | Enviar notificaciÃ³n manual |

### Pagos

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| POST | `/api/payments/confirm` | Confirmar pago |

**DocumentaciÃ³n completa:** Importar la colecciÃ³n de Postman en `/Postman/MedicalAppointments.postman_collection.json`

---

## ğŸ§ª Casos de Prueba

### Ejecutar Pruebas Unitarias

```bash
dotnet test WebApiCitas.Tests/WebApiCitas.Tests.csproj
```

### Casos de Prueba Principales

1. **CP-001**: Crear cita exitosamente
2. **CP-002**: Crear cita con pago
3. **CP-003**: Error - Paciente no encontrado
4. **CP-004**: Error - Horario no disponible
5. **CP-005**: Error - Pago rechazado
6. **CP-006**: Cancelar cita exitosamente
7. **CP-007**: ValidaciÃ³n de campos requeridos

Ver documentaciÃ³n completa en: `/Docs/CasosDePrueba.md`

---

## ğŸ“ Estructura del Proyecto

```
WebApiCitas/
â”œâ”€â”€ Controllers/
â”‚   â”œâ”€â”€ AppointmentCoordinatorController.cs
â”‚   â”œâ”€â”€ PatientsController.cs
â”‚   â”œâ”€â”€ DoctorsController.cs
â”‚   â””â”€â”€ AppointmentsController.cs
â”‚
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ AppointmentOrchestrator.cs
â”‚   â”œâ”€â”€ PatientService.cs
â”‚   â”œâ”€â”€ DoctorService.cs
â”‚   â”œâ”€â”€ ScheduleService.cs
â”‚   â”œâ”€â”€ NotificationService.cs
â”‚   â””â”€â”€ PaymentService.cs
â”‚
â”œâ”€â”€ Infrastructure/
â”‚   â”œâ”€â”€ Repositories/
â”‚   â”‚   â””â”€â”€ AppointmentRepository.cs
â”‚   â””â”€â”€ Messaging/
â”‚       â”œâ”€â”€ RabbitMQMessageBus.cs
â”‚       â””â”€â”€ MockMessageBus.cs
â”‚
â”œâ”€â”€ Interfaces/
â”‚   â”œâ”€â”€ IAppointmentOrchestrator.cs
â”‚   â”œâ”€â”€ IPatientService.cs
â”‚   â””â”€â”€ ... (otras interfaces)
â”‚
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ DTOs/
â”‚   â”‚   â”œâ”€â”€ AppointmentRequest.cs
â”‚   â”‚   â””â”€â”€ OrchestrationResult.cs
â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â”œâ”€â”€ Appointment.cs
â”‚   â”‚   â”œâ”€â”€ Patient.cs
â”‚   â”‚   â””â”€â”€ Doctor.cs
â”‚   â””â”€â”€ Events/
â”‚       â”œâ”€â”€ AppointmentCreatedEvent.cs
â”‚       â””â”€â”€ AppointmentCancelledEvent.cs
â”‚
â”œâ”€â”€ App_Start/
â”‚   â”œâ”€â”€ WebApiConfig.cs
â”‚   â””â”€â”€ DependencyConfig.cs
â”‚
â”œâ”€â”€ Database/
â”‚   â””â”€â”€ CreateDatabase.sql
â”‚
â”œâ”€â”€ Docs/
â”‚   â”œâ”€â”€ DocumentoTecnico.md
â”‚   â”œâ”€â”€ GuiaPasoAPaso.md
â”‚   â””â”€â”€ CasosDePrueba.md
â”‚
â”œâ”€â”€ Postman/
â”‚   â””â”€â”€ MedicalAppointments.postman_collection.json
â”‚
â”œâ”€â”€ Web.config
â”œâ”€â”€ Global.asax
â””â”€â”€ README.md
```

---

## ğŸ“š DocumentaciÃ³n

### Documentos Disponibles

- [Documento TÃ©cnico - PatrÃ³n SOA](Docs/DocumentoTecnico.md)
- [GuÃ­a Paso a Paso - ConstrucciÃ³n del Servicio](Docs/GuiaPasoAPaso.md)
- [Casos de Prueba y Ejemplos Funcionales](Docs/CasosDePrueba.md)
- [Diagrama de Arquitectura](Docs/Diagramas/)

### Referencias AcadÃ©micas

- Erl, T. (2016). *SOA: Principles of Service Design*. Prentice Hall.
- Newman, S. (2015). *Building Microservices*. O'Reilly Media.
- Hohpe, G., & Woolf, B. (2012). *Enterprise Integration Patterns*. Addison-Wesley.

---

## ğŸ¤ ContribuciÃ³n

Las contribuciones son bienvenidas. Por favor:

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

### GuÃ­a de Estilo

- Seguir convenciones de C# estÃ¡ndar
- Documentar mÃ©todos pÃºblicos con XML comments
- Escribir pruebas unitarias para nuevas funcionalidades
- Mantener cobertura de cÃ³digo > 80%

---

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para mÃ¡s detalles.

---

## ğŸ‘¤ Autor

**Tu Nombre**

- GitHub: [@tu-usuario](https://github.com/tu-usuario)
- LinkedIn: [Tu Perfil](https://linkedin.com/in/tu-perfil)
- Email: tu-email@ejemplo.com

---

## ğŸ™ Agradecimientos

- Universidad [Nombre] - CÃ¡tedra de Arquitectura de Software
- Profesor [Nombre] - AsesorÃ­a acadÃ©mica
- Comunidad ASP.NET por recursos y documentaciÃ³n

---

## ğŸ“ Notas Adicionales

### Mejoras Futuras

- [ ] Implementar autenticaciÃ³n JWT
- [ ] Agregar Swagger/OpenAPI documentation
- [ ] Implementar Circuit Breaker pattern
- [ ] Agregar cache distribuido (Redis)
- [ ] Migrar a .NET 6/8
- [ ] Containerizar con Docker
- [ ] Implementar CI/CD con GitHub Actions

### Problemas Conocidos

- El sistema no maneja zonas horarias mÃºltiples
- Falta implementaciÃ³n de rate limiting
- No hay soporte para reprogramaciÃ³n de citas

---

## ğŸ“ Soporte

Si encuentras algÃºn problema o tienes preguntas:

1. Revisa la [documentaciÃ³n](Docs/)
2. Busca en [Issues](https://github.com/tu-usuario/medical-appointments-api/issues)
3. Crea un nuevo issue si es necesario

---

**â­ Si este proyecto te fue Ãºtil, considera darle una estrella en GitHub**

---

*Ãšltima actualizaciÃ³n: Octubre 2025*